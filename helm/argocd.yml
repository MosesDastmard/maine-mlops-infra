# ArgoCD Helm Values
# GitOps continuous delivery tool for Kubernetes

global:
  image:
    tag: "v2.13.3"

# Server configuration
server:
  replicas: 1

  # Expose via NodePort
  service:
    type: NodePort
    nodePortHttp: 30200
    nodePortHttps: 30201

  # Disable TLS on server (use HTTP)
  extraArgs:
    - --insecure

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Controller configuration
controller:
  replicas: 1
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"

# Repo server configuration
repoServer:
  replicas: 1
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  extraArgs:
    - --parallelismlimit=2
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 30
    failureThreshold: 5
  readinessProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 3

# Redis configuration (bundled)
redis:
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

# ApplicationSet controller
applicationSet:
  replicas: 1
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

# Notifications controller
notifications:
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

# Dex (SSO) - disabled for simplicity
dex:
  enabled: false

# Config settings
configs:
  params:
    # Disable TLS (running behind ingress or using HTTP)
    server.insecure: true

  # Repository credentials (for private repos)
  # Uncomment and configure if your repo is private
  credentialTemplates:
    github-https:
      url: https://github.com
      # For private repos, create a secret with these keys:
      # username: your-github-username
      # password: your-github-token (PAT with repo access)
      # Or use SSH:
      # sshPrivateKey: |
      #   -----BEGIN OPENSSH PRIVATE KEY-----
      #   ...
      #   -----END OPENSSH PRIVATE KEY-----

  # Repository definitions
  repositories:
    # UPDATE THIS: Add your infrastructure repository
    # infra-repo:
    #   url: https://github.com/MosesDastmard/maine-mlops-infra.git
    #   name: infra
    #   type: git

  # CM configuration
  cm:
    # Kustomize build options
    kustomize.buildOptions: --enable-helm

    # Resource tracking method
    application.resourceTrackingMethod: annotation

    # Health checks for custom resources
    resource.customizations.health.kafka.strimzi.io_Kafka: |
      hs = {}
      if obj.status ~= nil then
        if obj.status.conditions ~= nil then
          for i, condition in ipairs(obj.status.conditions) do
            if condition.type == "Ready" and condition.status == "True" then
              hs.status = "Healthy"
              hs.message = "Kafka cluster is ready"
              return hs
            end
          end
        end
      end
      hs.status = "Progressing"
      hs.message = "Waiting for Kafka cluster to be ready"
      return hs

    resource.customizations.health.kafka.strimzi.io_KafkaConnect: |
      hs = {}
      if obj.status ~= nil then
        if obj.status.conditions ~= nil then
          for i, condition in ipairs(obj.status.conditions) do
            if condition.type == "Ready" and condition.status == "True" then
              hs.status = "Healthy"
              hs.message = "Kafka Connect is ready"
              return hs
            end
          end
        end
      end
      hs.status = "Progressing"
      hs.message = "Waiting for Kafka Connect to be ready"
      return hs
