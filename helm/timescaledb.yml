# TimescaleDB Helm Values
# Time-series database for storing sales data from Kafka

# Using Bitnami PostgreSQL with TimescaleDB extension
global:
  security:
    allowInsecureImages: true

image:
  registry: docker.io
  repository: timescale/timescaledb-ha
  tag: pg16.11-ts2.24.0-all

# Authentication
auth:
  postgresPassword: Moses1749TimescaleAdmin!
  username: mlops
  password: Moses1749Timescale!

# Primary configuration
primary:
  service:
    type: NodePort
    nodePorts:
      postgresql: "30432"
  extraVolumes:
    - name: postgresql-run
      emptyDir: {}
  extraVolumeMounts:
    - name: postgresql-run
      mountPath: /var/run/postgresql
  persistence:
    enabled: true
    storageClass: local-path
    size: 50Gi
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "4Gi"
      cpu: "2000m"
  # TimescaleDB-specific settings
  extendedConfiguration: |
    shared_preload_libraries = 'timescaledb,pg_cron'
    cron.database_name = 'postgres'
    timescaledb.telemetry_level = 'off'
    max_connections = 200
    shared_buffers = 1GB
    effective_cache_size = 3GB
    maintenance_work_mem = 512MB
    work_mem = 32MB
    max_parallel_workers_per_gather = 2
    max_parallel_workers = 4
    wal_buffers = 64MB
    min_wal_size = 512MB
    max_wal_size = 2GB

# Disable replication for single-node setup
architecture: standalone

# Metrics
metrics:
  enabled: true
  serviceMonitor:
    enabled: false
